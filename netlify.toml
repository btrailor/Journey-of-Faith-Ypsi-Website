[build]
  # Build the actual site for OAuth functionality
  command = "npm run build"
  publish = "_site"

[build.environment]
  NODE_VERSION = "18"

# Identity and Git Gateway settings for CMS
[identity]
  path = "/admin/"

# Optimize asset delivery
[[headers]]
  for = "/*"
  [headers.values]
    # Cache static assets for 1 year
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.html"
  [headers.values]
    # HTML files: cache for 1 hour
    Cache-Control = "public, max-age=3600, must-revalidate"

[[headers]]
  for = "/images/*"
  [headers.values]
    # Images: cache for 1 month
    Cache-Control = "public, max-age=2592000, immutable"

# Critical: Safari video support requires Range headers
[[headers]]
  for = "/*.mp4"
  [headers.values]
    Accept-Ranges = "bytes"
    Cache-Control = "public, max-age=31536000"
    Content-Type = "video/mp4"

[[headers]]
  for = "/*.mov"
  [headers.values]
    Accept-Ranges = "bytes"
    Cache-Control = "public, max-age=31536000"
    Content-Type = "video/quicktime"

[[headers]]
  for = "/*.webm"
  [headers.values]
    Accept-Ranges = "bytes"
    Cache-Control = "public, max-age=31536000"
    Content-Type = "video/webm"

[[redirects]]
  from = "/admin"
  to = "/admin/"
  status = 301

[[redirects]]
  from = "/admin/*"
  to = "/admin/index.html"
  status = 200
